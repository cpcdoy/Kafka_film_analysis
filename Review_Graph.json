{"paragraphs":[{"text":"import scala.util.parsing.json.JSON\nimport org.apache.spark.SparkContext\nimport org.apache.spark.SparkConf\nimport scala.math._\n\n  case class Film(\n                   id: String,\n                   title: String,\n                   release_date: String,\n                   popularity: String,\n                   revenue: String,\n                   budget: String,\n                   genre_list : String,\n                   review_list : String,\n                   analyzed_popularity : String\n                  )\n\n  def parseJSON(s: String): Map[String, Any] =\n    JSON.parseFull(s).get.asInstanceOf[Map[String, Any]]\n\n  def parseFilm(s : String) : Film =  {\n    val json = parseJSON(s)\n    Film(json(\"id\").toString,\n      json(\"title\").toString,\n      json(\"release_date\").toString,\n      json(\"popularity\").toString,\n      json(\"revenue\").toString,\n      json(\"budget\").toString,\n      json(\"genre_list\").toString,\n      json(\"review_list\").toString,\n      json(\"analyzed_popularity\").toString)\n  }\n\nval jsons = sc.textFile(\"/home/axel/Documents/Hadoop_Spark/Kafka_film_analysis/2_kafka_client/test/[0-9]*/part-[0-9]*\")\n\ncase class Movie(title : String, release : String, analyzed_popularity : String, revenue : String, budget : String, genre : String, popularity : String)\n\nval movies = jsons.map(parseFilm).map(\n        m => Movie(m.title,\n                   m.release_date.take(4),\n                   (m.analyzed_popularity.toDouble * 100).toString,\n                   m.revenue,\n                   m.budget,\n                   m.genre_list.drop(5).dropRight(1).split(\", \")(0),\n                   m.popularity)\n    )\nval best_popularity = (movies.takeOrdered(1)(Ordering[Double].reverse.on(_.analyzed_popularity.toDouble)))(0)\n\nval norm_movies = movies.collect().map(m => m.copy(analyzed_popularity = (m.analyzed_popularity.toDouble * 10 / (best_popularity.analyzed_popularity.toDouble)).toString))\n\n// convert to DataFrame and create temporal table\nval rdd = sc.parallelize(norm_movies) \n\nrdd.toDF().registerTempTable(\"movies\")","user":"anonymous","dateUpdated":"2017-07-09T19:54:10+0200","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nimport scala.util.parsing.json.JSON\n\nimport org.apache.spark.SparkContext\n\nimport org.apache.spark.SparkConf\n\nimport scala.math._\n\ndefined class Film\n\nparseJSON: (s: String)Map[String,Any]\n\nparseFilm: (s: String)Film\n\njsons: org.apache.spark.rdd.RDD[String] = /home/axel/Documents/Hadoop_Spark/Kafka_film_analysis/2_kafka_client/test/[0-9]*/part-[0-9]* MapPartitionsRDD[509] at textFile at <console>:258\n\ndefined class Movie\n\nmovies: org.apache.spark.rdd.RDD[Movie] = MapPartitionsRDD[511] at map at <console>:268\n\nbest_popularity: Movie = Movie(Gladiator,2000,30.627157479833578,457640427,103000000,Action,6.535941)\nnorm_movies: Array[Movie] = Array(Movie(Kill Bill: Vol. 1,2003,2.865258364697134,180949000,30000000,Action,5.211504), Movie(The Elementary Particles,2006,4.086153945611621,0,6000000,Drama,0.679149), Movie(The Dark,2006,1.5183282457074192,0,0,Horror,2.067508), Movie(Before Sunset,2004,7.897440252596047,15992615,2700000,Drama,1.559795), Movie(Absolute Power,1997,4.598624049522914,50068310,50000000,Crime,1.810847), Movie(Metropolis,1927,5.784198422157347,650422,92620000,Drama,2.049901), Movie(2001: A Space Odyssey,1968,4.983161523244447,68700000,10500000,Science Fiction,5.749131), Movie(Twelve Monkeys,1995,5.659644852408618,168840000,29500000,Science Fiction,4.065366), Movie(Finding Nemo,2003,8.635092514503972,940335536,94000000,Animation,7.867613), Movie(Kill Bill: Vol. 1,2003,2.865258364...\nrdd: org.apache.spark.rdd.RDD[Movie] = ParallelCollectionRDD[513] at parallelize at <console>:275\n\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"}]},"apps":[],"jobName":"paragraph_1499611724359_-1320136841","id":"20170706-202304_1759173485","dateCreated":"2017-07-09T16:48:44+0200","dateStarted":"2017-07-09T19:54:10+0200","dateFinished":"2017-07-09T19:55:15+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:250"},{"text":"%sql \nselect analyzed_popularity, (revenue - budget)\nfrom movies\nwhere budget > 0\norder by analyzed_popularity asc","user":"anonymous","dateUpdated":"2017-07-09T19:41:54+0200","config":{"colWidth":12,"editorMode":"ace/mode/sql","results":{"0":{"graph":{"mode":"stackedAreaChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{"stacked":false},"scatterChart":{"xAxis":{"name":"analyzed_popularity","index":0,"aggr":"sum"},"yAxis":{"name":"genre","index":1,"aggr":"sum"}},"lineChart":{"forceY":false},"pieChart":{},"stackedAreaChart":{"style":"stack"}},"keys":[{"name":"analyzed_popularity","index":0,"aggr":"sum"},{"name":"(CAST(revenue AS DOUBLE) - CAST(budget AS DOUBLE))","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"analyzed_popularity","index":0,"aggr":"sum"},{"name":"(CAST(revenue AS DOUBLE) - CAST(budget AS DOUBLE))","index":1,"aggr":"sum"}],"commonSetting":{}},"helium":{}}},"enabled":true,"editorSetting":{"language":"sql"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"analyzed_popularity\t(CAST(revenue AS DOUBLE) - CAST(budget AS DOUBLE))\n1.2291532970506707\t-20000.0\n1.7582937721634964\t3.24968763E8\n1.7982517353265763\t3.05E8\n1.9805610984586506\t2.7231879E7\n1.9805610984586526\t2.7231879E7\n10.0\t3.54640427E8\n2.1535509268900346\t4.59739379E8\n2.1535509268900386\t4.59739379E8\n2.2502565294707653\t5.4537954E7\n2.2502565294707666\t5.4537954E7\n2.8207441066574432\t4.52068851E8\n2.8207441066574455\t4.52068851E8\n2.865258364697134\t1.50949E8\n2.8652583646971346\t1.50949E8\n3.036727489992364\t2.8740827E7\n3.0367274899923813\t2.8740827E7\n3.3918581491045523\t-4729478.0\n3.493643801515257\t3875127.0\n3.4936438015152618\t3875127.0\n3.721024094075255\t2.647142E7\n3.753799792923781\t574623.0\n3.7537997929237905\t574623.0\n3.8401521338539557\t4.0884703E7\n4.086153945611621\t-6000000.0\n4.086153945611623\t-6000000.0\n4.134971099774866\t4.13799566E8\n4.168511025638028\t1.45157447E8\n4.168511025638031\t1.45157447E8\n4.283391854019997\t7.0306374E7\n4.403509084301246\t300000.0\n4.4035090843012465\t300000.0\n4.499834395417741\t8.65659812E8\n4.499834395417746\t8.65659812E8\n4.598624049522914\t68310.0\n4.598624049522923\t68310.0\n4.670706323317202\t3.0723096E7\n4.670706323317203\t3.0723096E7\n4.776224660265553\t5.7960381E7\n4.776224660265554\t5.7960381E7\n4.803154417034217\t2.6962574E7\n4.841944283557404\t1.7392018E8\n4.841944283557409\t1.7392018E8\n4.957232364590993\t2.8794509E7\n4.957232364590996\t2.8794509E7\n4.983161523244447\t5.82E7\n4.9831615232444495\t5.82E7\n4.9986775448643375\t2.07954274E8\n5.22659776563671\t657189.0\n5.297968923371125\t5139618.0\n5.297968923371139\t5139618.0\n5.31872260635609\t3.1371017E7\n5.31872260635609\t3.1371017E7\n5.413485130948884\t-1.5E7\n5.4134851309488905\t-1.5E7\n5.489841822668298\t2.4889998E7\n5.489841822668303\t2.4889998E7\n5.569902983046065\t2.2377947E7\n5.569902983046066\t2.2377947E7\n5.608550240700359\t-1250000.0\n5.659644852408615\t1.3934E8\n5.659644852408618\t1.3934E8\n5.694206751131558\t3.1189568E7\n5.773146948242424\t-1400000.0\n5.773146948242425\t-1400000.0\n5.784198422157342\t-9.1969578E7\n5.784198422157347\t-9.1969578E7\n5.94117050076517\t3.5266982E7\n6.002876653787501\t5737585.0\n6.048514632219685\t2547569.0\n6.052426255463037\t5.96E7\n6.346563039124375\t1.8908467E7\n6.346563039124382\t1.8908467E7\n6.470821340761802\t2.79965036E8\n6.549507464077538\t3.41296601E8\n6.549507464077541\t3.41296601E8\n6.599558458995775\t-2500000.0\n6.678086613734527\t5.2258126E7\n6.678086613734527\t5.2258126E7\n6.723386958400643\t7.3557872E7\n6.734934206033145\t4.49E8\n6.756460451883591\t4.1716081E7\n6.756460451883603\t4.1716081E7\n6.943921756480253\t5.1270454E7\n6.99917292794046\t1.74E8\n6.999172927940485\t1.74E8\n7.065504041725643\t1.46394432E8\n7.065504041725661\t1.46394432E8\n7.116767850411758\t8.472874E8\n7.192414926441448\t1.6E7\n7.254793945802905\t1.64043761E8\n7.3735877457829355\t7.64398007E8\n7.3735877457829435\t7.64398007E8\n7.436599473428446\t8.0235548E7\n7.446684338127463\t3.71925971E8\n7.4466843381274765\t3.71925971E8\n7.491557522457904\t1.86763646E8\n7.491557522457907\t1.86763646E8\n7.6291530461078745\t4.5E7\n7.791528214961396\t1.32875308E8\n7.897440252596047\t1.3292615E7\n7.897440252596072\t1.3292615E7\n8.070697998973154\t5.6306973E7\n8.123312382046032\t5.15011224E8\n8.123312382046048\t5.15011224E8\n8.123571030563323\t3035405.0\n8.123571030563332\t3035405.0\n8.135137568342406\t2.9284974E7\n8.330175824974491\t2.59925095E8\n8.354951105672212\t2301446.0\n8.354951105672235\t2301446.0\n8.635092514503972\t8.46335536E8\n8.63509251450398\t8.46335536E8\n8.806208741692894\t1.05E8\n8.806208741692902\t1.05E8\n8.829692149501602\t1.024888979E9\n9.04770200274913\t6.22945399E8\n9.047702002749133\t6.22945399E8\n9.086949970771201\t4.26171806E8\n9.180467101213067\t3.01360478E8\n9.24000102820433\t7.78368364E8\n9.412927433166264\t3.62109762E8\n9.607227116667417\t1.58438883E8\n9.60722711666743\t1.58438883E8\n"}]},"apps":[],"jobName":"paragraph_1499611724359_-1320136841","id":"20170707-194232_1971413586","dateCreated":"2017-07-09T16:48:44+0200","dateStarted":"2017-07-09T19:14:20+0200","dateFinished":"2017-07-09T19:14:20+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:252"},{"text":"%sql \nselect Avg(analyzed_popularity), release\nfrom movies\ngroup by release","user":"anonymous","dateUpdated":"2017-07-09T19:41:53+0200","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"stackedAreaChart","height":300,"optionOpen":false,"setting":{"stackedAreaChart":{},"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"release","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"avg(CAST(analyzed_popularity AS DOUBLE))","index":0,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"avg(CAST(analyzed_popularity AS DOUBLE))\trelease\n5.952528603615003\t1987\n5.22659776563671\t1931\n5.24226178780078\t1988\n4.457543126043032\t1932\n7.37358774578294\t1977\n6.922155261971024\t1984\n5.92945092439457\t1982\n5.569902983046065\t1941\n4.93423313639339\t2005\n6.2294918015481935\t2000\n5.608550240700359\t1930\n7.44668433812747\t1981\n3.721024094075255\t1978\n6.72700899674571\t2002\n6.671759069208743\t1959\n6.06224165575773\t1995\n3.7653872378319453\t2006\n5.784198422157345\t1927\n4.803154417034217\t1976\n4.983161523244448\t1968\n6.041766751884189\t1967\n5.66382660150893\t2004\n9.086949970771201\t1989\n4.168511025638029\t1992\n8.612875290593838\t1966\n6.075199287721896\t1999\n7.765436812967453\t1994\n5.334532976224409\t1997\n2.820744106657444\t2007\n5.31872260635609\t1996\n3.8401521338539557\t1983\n3.873888627265427\t1986\n6.305610889167204\t1985\n4.776224660265553\t1979\n4.811309456657355\t1998\n6.1044727492922295\t1993\n6.987345000761125\t2001\n6.734934206033145\t1990\n6.602438915907527\t2003\n3.3368495195361265\t1970\n1.2291532970506707\t1933\n"}]},"apps":[],"jobName":"paragraph_1499615324344_149048630","id":"20170709-174844_1345944561","dateCreated":"2017-07-09T17:48:44+0200","dateStarted":"2017-07-09T19:40:58+0200","dateFinished":"2017-07-09T19:41:00+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:253"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"stackedAreaChart":{}},"commonSetting":{},"keys":[{"name":"genre","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"avg(CAST(analyzed_popularity AS DOUBLE))","index":0,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1499619474173_91635080","id":"20170709-185754_10665554","dateCreated":"2017-07-09T18:57:54+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:868","text":"%sql \nselect Avg(analyzed_popularity), genre\nfrom movies\ngroup by genre","dateUpdated":"2017-07-09T19:56:31+0200","dateFinished":"2017-07-09T19:51:47+0200","dateStarted":"2017-07-09T19:51:46+0200","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"avg(CAST(analyzed_popularity AS DOUBLE))\tgenre\n5.29553400139209\tCrime\n6.6516627240919215\tRomance\n6.283095253858615\tThriller\n6.391915568613379\tAdventure\n5.668416841947195\tDrama\n5.566704029931733\tDocumentary\n5.1476860227181\tFantasy\n5.120304653181634\tMystery\n5.72791831058071\tAnimation\n5.986673822538735\tScience Fiction\n2.7544180856838505\tHorror\n4.168511025638029\tWestern\n6.3098250130268125\tComedy\n5.587857350136071\tAction\n"}]}},{"text":"%sql\n","user":"anonymous","dateUpdated":"2017-07-09T19:53:34+0200","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1499622814949_-2128404945","id":"20170709-195334_33815636","dateCreated":"2017-07-09T19:53:34+0200","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4620"}],"name":"Review Graph","id":"2CP8B4N22","angularObjects":{"2CPB34M74:shared_process":[],"2CPF53KX1:shared_process":[],"2CQ9TJRVK:shared_process":[],"2CPDX15QE:shared_process":[],"2CPB8BXKF:shared_process":[],"2CP81SN5F:shared_process":[],"2CMN7N15V:shared_process":[],"2CM4JSU3B:shared_process":[],"2CPZCY558:shared_process":[],"2CMEWD7DH:shared_process":[],"2CQ3PY5E2:shared_process":[],"2CQ79J1PB:shared_process":[],"2CNU92DEN:shared_process":[],"2CKTUAHJ4:shared_process":[],"2CNUGW8BE:shared_process":[],"2CQ3U3PHS:shared_process":[],"2CKGFJY9N:shared_process":[],"2CKSM3895:shared_process":[],"2CNTN6W2K:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}